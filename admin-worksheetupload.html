<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Worksheet Dashboard</title>
<style>
:root {
  --pastel-purple: #d7d9f2; --pastel-blue: #e4ecf6; --pastel-mint: #cbe6e4;
  --pastel-pink: #f6dde8; --pastel-peach: #faede7; --pastel-ivory: #f6f1eb;
}
body { margin:0; font-family:'Segoe UI',Arial,sans-serif;
  background: linear-gradient(to right, var(--pastel-purple), var(--pastel-blue), var(--pastel-mint), var(--pastel-pink), var(--pastel-peach), var(--pastel-ivory));
  min-height:100vh; color:#444; }
header { background: var(--pastel-purple); box-shadow:0 2px 8px rgba(0,0,0,0.06); display:flex; justify-content:space-between; align-items:center; padding:1rem 2rem; }
header h1 { margin:0; font-size:2rem; color:#3a4667; font-weight:bold; }
header a { text-decoration:none; color:#3a4667; font-weight:bold; font-size:1rem; }
.content { max-width:1000px; margin:2rem auto; padding:0 1rem; }
label { font-weight:600; color:#477990; margin-right:10px; }
select, input { font-size:1.05rem; padding:8px 14px; border-radius:10px; border:2px solid var(--pastel-mint); margin-bottom:10px; width:100%; box-sizing:border-box; }
button, .preview-btn { padding:8px 14px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; margin-left:6px; text-decoration:none; display:inline-block; }
.add-btn { background:var(--pastel-peach); }
.add-btn:hover { background:var(--pastel-pink); color:#ae4879; }
.section-title { font-size:1.5rem; font-weight:700; color:#527b80; margin:1rem 0 0.8rem; }
.worksheet-list { margin-top:1rem; }
.worksheet-item { background: linear-gradient(120deg, var(--pastel-mint) 55%, var(--pastel-blue) 100%); border-radius:14px; padding:10px; margin-bottom:15px; box-shadow:0 4px 12px rgba(50,50,70,0.08); display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
.worksheet-buttons { display:flex; gap:6px; }
.delete-btn { background:#fa6d6d; color:#fff; padding:4px 10px; border-radius:8px; cursor:pointer; }
.delete-btn:hover { background:#c54b7b; }
.preview-btn { background:#6da4fa; color:#fff; padding:4px 10px; border-radius:8px; cursor:pointer; }
.preview-btn:hover { background:#4b7ccc; }

/* Modal styling */
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
}
.modal-content {
  position: relative;
  background: white;
  margin: 3% auto;
  padding: 1rem;
  border-radius: 10px;
  width: 80%;
  max-width: 900px;
  height: 80%;
  box-shadow: 0 0 20px rgba(0,0,0,0.3);
  display: flex;
  flex-direction: column;
}
.modal iframe {
  width: 100%;
  height: 100%;
  border: none;
  border-radius: 10px;
}
.close-btn {
  position: absolute;
  top: 10px;
  right: 20px;
  background: #fa6d6d;
  color: #fff;
  border: none;
  font-size: 1.2rem;
  font-weight: bold;
  border-radius: 5px;
  cursor: pointer;
  padding: 4px 10px;
}
.close-btn:hover { background: #c54b7b; }
</style>
</head>
<body>

<header>
<h1>Admin Dashboard - Worksheets</h1>
<nav>
<a href="index.html">üè† Home</a> &nbsp;|&nbsp;
<a href="user1dashboard.html">üë§ User Dashboard</a>
</nav>
</header>

<div class="content">
<div class="section-title">Upload New Worksheet</div>
<label for="book-select">Select Book:</label>
<select id="book-select"><option value="">-- Select a book --</option></select>

<label for="worksheet-title">Worksheet Title:</label>
<input type="text" id="worksheet-title" placeholder="Enter worksheet title">

<label for="worksheet-file">Upload PDF:</label>
<input type="file" id="worksheet-file" accept="application/pdf">

<button id="save-worksheet" class="add-btn">üíæ Save Worksheet</button>

<div class="section-title">Existing Worksheets</div>
<div id="existing-worksheets" class="worksheet-list"></div>
</div>

<!-- Modal for preview -->
<div id="pdfModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" id="closeModal">X</button>
    <iframe id="pdfFrame"></iframe>
  </div>
</div>

<script>
// ===== BOOK LIST =====
const books = {
  old: ["Genesis","Exodus","Leviticus","Numbers","Deuteronomy","Joshua","Judges","Ruth","1 Samuel","2 Samuel"],
  new: ["Matthew","Mark","Luke","John","Acts","Romans","1 Corinthians","2 Corinthians","Galatians","Ephesians"]
};
const bookSelect = document.getElementById('book-select');
Object.values(books).flat().forEach(book=>{
  const opt=document.createElement('option');
  opt.value=book; opt.textContent=book;
  bookSelect.appendChild(opt);
});

// ===== LOAD WORKSHEETS =====
let worksheets = JSON.parse(localStorage.getItem('worksheetData') || '{}');
function saveWorksheetsToLocalStorage() {
  localStorage.setItem('worksheetData', JSON.stringify(worksheets));
  window.dispatchEvent(new Event("storage"));
}

// ===== DISPLAY WORKSHEETS =====
function showExistingWorksheets(book){
  const container = document.getElementById('existing-worksheets');
  container.innerHTML='';
  if(!book || !worksheets[book] || worksheets[book].length===0){
    container.textContent='No worksheets for this book.';
    return;
  }
  worksheets[book].forEach((ws,idx)=>{
    const wsDiv=document.createElement('div');
    wsDiv.className='worksheet-item';
    const titleSpan=document.createElement('span');
    titleSpan.innerHTML=`<b>${ws.title}</b>`;
    const btnDiv=document.createElement('div');
    btnDiv.className='worksheet-buttons';

    const previewBtn=document.createElement('button');
    previewBtn.className='preview-btn';
    previewBtn.textContent='Preview';
    previewBtn.onclick=()=>{
      openPDF(ws.url);
    };

    const deleteBtn=document.createElement('button');
    deleteBtn.className='delete-btn';
    deleteBtn.textContent='Delete';
    deleteBtn.onclick=()=>{
      worksheets[book].splice(idx,1);
      saveWorksheetsToLocalStorage();
      showExistingWorksheets(book);
    };

    btnDiv.appendChild(previewBtn);
    btnDiv.appendChild(deleteBtn);
    wsDiv.appendChild(titleSpan);
    wsDiv.appendChild(btnDiv);
    container.appendChild(wsDiv);
  });
}

// ===== SAVE NEW WORKSHEET =====
document.getElementById('save-worksheet').addEventListener('click', ()=>{
  const book=bookSelect.value.trim();
  const title=document.getElementById('worksheet-title').value.trim();
  const fileInput=document.getElementById('worksheet-file');
  const file=fileInput.files[0];

  if(!book){ alert('Select a book!'); return; }
  if(!title){ alert('Enter a title!'); return; }
  if(!file){ alert('Select a PDF file!'); return; }
  if(file.type!=='application/pdf'){ alert('Only PDF allowed!'); return; }

  const reader = new FileReader();
  reader.onload = function(e) {
    const base64 = e.target.result;
    if(!worksheets[book]) worksheets[book] = [];
    worksheets[book].push({ title, url: base64, date: new Date().toISOString().split('T')[0] });
    saveWorksheetsToLocalStorage();
    document.getElementById('worksheet-title').value='';
    fileInput.value='';
    showExistingWorksheets(book);
    alert('Worksheet saved successfully!');
  };
  reader.readAsDataURL(file);
});

// ===== PREVIEW MODAL LOGIC =====
const modal = document.getElementById('pdfModal');
const iframe = document.getElementById('pdfFrame');
const closeModal = document.getElementById('closeModal');

function openPDF(base64){
  iframe.src = base64;
  modal.style.display = 'block';
}

closeModal.onclick = ()=> {
  modal.style.display = 'none';
  iframe.src = ''; // clear for memory
};

window.onclick = (e)=>{
  if(e.target===modal){
    modal.style.display = 'none';
    iframe.src = '';
  }
};

// ===== ON BOOK CHANGE =====
bookSelect.addEventListener('change',()=>{
  document.getElementById('worksheet-title').value='';
  document.getElementById('worksheet-file').value='';
  showExistingWorksheets(bookSelect.value);
});
</script>
</body>
</html>
